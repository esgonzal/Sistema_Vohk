<app-loader [loader]="isLoading"></app-loader>
<div class="container" *ngIf="popupService.newGroup" [ngClass]="{'dark-mode': DarkModeService.darkMode}">
    <div class="header">
        Crear Comunidad
    </div>
    <div id="content">
        <div class="form-area">
            <form class="common-form">
                Nombre
                <input type="text" class="form-input" name="name" [(ngModel)]="name" />
                <p class="error">{{error}}</p>
            </form>
        </div>
    </div>
    <div id="actions">
        <button (click)="popupService.newGroup = false">Volver</button>
        <button (click)="crearGrupo()">Guardar</button>
    </div>
</div>
<div class="container" *ngIf="popupService.addLockGROUP" [ngClass]="{'dark-mode': DarkModeService.darkMode}">
    <div class="header">
        Agregar Cerradura a {{popupService.group.groupName}}
    </div>
    <div id="content" style="justify-content: flex-start; ">
        <table class="lock-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Agregar</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngIf="popupService.locksWithoutGroup.length > 0; else noLocks">
                    <tr *ngFor="let lock of popupService.locksWithoutGroup">
                        <td>{{ lock.lockAlias }}</td>
                        <td style="text-align: center">
                            <input type="checkbox" (change)="toggleLockSelection(lock.lockId, lock.lockAlias)">
                        </td>
                    </tr>
                </ng-container>
                <ng-template #noLocks>
                    <tr>
                        <td colspan="2">No existen cerraduras disponibles para agregar a este grupo.</td>
                    </tr>
                </ng-template>
            </tbody>
        </table>
    </div>
    <p class="error">{{error}}</p>
    <div id="actions">
        <button (click)="popupService.addLockGROUP = false">Volver</button>
        <button (click)="addSelectedLocksToGroup()">Agregar</button>
    </div>
</div>
<div class="container" *ngIf="popupService.removeLockGROUP" [ngClass]="{'dark-mode': DarkModeService.darkMode}">
    <div class="header">
        Remover Cerradura de {{popupService.group.groupName}}
    </div>

    <div id="content">
        <table class="lock-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Remover</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngIf="popupService.group.locks.length > 0; else noLocks">
                    <tr *ngFor="let lock of popupService.group.locks">
                        <td>{{ lock.lockAlias }}</td>
                        <td style="text-align: center">
                            <input type="checkbox" (change)="toggleLockSelection(lock.lockId, lock.lockAlias)">
                        </td>
                    </tr>
                </ng-container>
                <ng-template #noLocks>
                    <tr>
                        <td colspan="2">No existen cerraduras disponibles para remover de este grupo.</td>
                    </tr>
                </ng-template>
            </tbody>
        </table>
    </div>
    <p class="error">{{error}}</p>
    <div id="actions">
        <button (click)="popupService.removeLockGROUP = false">Volver</button>
        <button (click)="removeSelectedLocksFromGroup()">Remover</button>
    </div>
</div>
<div class="container" *ngIf="popupService.selectLocksForMultipleEkeys" [ngClass]="{'dark-mode': DarkModeService.darkMode}">
    <div class="header">
        Seleccione Cerradura para compartir
    </div>
    <div id="content">
        <div class="form-area">
            <div *ngFor="let lock of ekeyService.currentLocks">
                <label>
                    <input type="checkbox" [value]="lock.lockId"
                        (change)="popupService.toggleLockSelection(lock.lockId, lock.lockAlias)"
                        [checked]="isLockSelected(lock.lockId)">
                    {{ lock.lockAlias }}
                </label>
            </div>
        </div>
    </div>
    <div id="actions">
        <button (click)="selectLocks()">OK</button>
    </div>
</div>
<div class="container" *ngIf="popupService.addRecipientsForMultipleEkeys" [ngClass]="{'dark-mode': DarkModeService.darkMode}">
    <div class="header">
        Añadir Receptor(es)
    </div>
    <div id="content">
        <div class="form-area">
            <form #addRecipient="ngForm" class="common-form">
                <div *ngFor="let recipient of popupService.recipients; let i = index" class="recipient-pair" style="display: flex;">
                    <div>
                        <p>
                            Cuenta del Destinatario
                            <input type="text" class="form-input" required [(ngModel)]="recipient.username" name="recipientAccount{{i}}" (ngModelChange)="validateEmailPhone(recipient.username)">
                        </p>
                        <p>
                            Nombre de ekey
                            <input type="text" class="form-input" required [(ngModel)]="recipient.ekeyName" name="ekeyName{{i}}">
                        </p>
                    </div>
                    <div style="display: flex; flex-direction: column; justify-content: center;">
                        <button type="button" class="x-button" (click)="removeRecipientPair(i)">X</button>
                    </div>
                </div>
                <p class="error">{{error}}</p>
            </form>
        </div>
    </div>
    <div id="actions" style="justify-content: space-around;">
        <div>
            <button type="button" (click)="addRecipientPair()">+Añadir</button>
        </div>
        <div style="display:flex ;gap: 20px;">
            <button (click)="popupService.addRecipientsForMultipleEkeys = false">Volver</button>
            <button type="submit" (click)="confirmRecipients()">OK</button>
        </div>
    </div>
</div>
<div class="container" *ngIf="popupService.cardReader" [ngClass]="{'dark-mode': DarkModeService.darkMode}">
    <div class="header">
        Acerque la tarjeta al lector
    </div>
    <div id="content">
        <img src="../../../assets/images/imagenCard.png">
    </div>
    <div id="actions">
        <button (click)="popupService.cardReader=false">Volver</button>
    </div>
</div>
<div class="container_sin_width" *ngIf="popupService.emailSuccess" [ngClass]="{'dark-mode': DarkModeService.darkMode}">
    <div class="header">
        Se enviará el siguiente correo al usuario
    </div>
    <div id="content" style="background-color: rgb(245, 245, 245);">
        <textarea [(ngModel)]="emailMessage" rows="10" cols="50"></textarea>
        <!-- <div [innerHTML]="popupService.emailMessage"></div> -->
    </div>
    <div id="actions">
        <button (click)="cancelEmail()">Volver</button>
        <button (click)="copyToClipboard()">Copiar mensaje</button>
        <button (click)="saveEmail()">Confirmar</button>
    </div>
    <div *ngIf="isCopied" class="confirmation-message">
        El mensaje fue copiado.
    </div>
</div>
<div class="container" *ngIf="popupService.excelFingerprints" [ngClass]="{'dark-mode': DarkModeService.darkMode}">
    <div class="header">
        Introduzca un nombre para el archivo
    </div>
    <div id="content">
        <div class="form-area">
            <form class="common-form">
                Nombre
                <input type="text" class="form-input" name="name" [(ngModel)]="name" />
                <p class="error">{{error}}</p>
            </form>
        </div>
    </div>
    <div id="actions">
        <button (click)="this.popupService.excelFingerprints=false">Cancelar</button>
        <button (click)="exportFingerprintsToExcel()">Exportar</button>
    </div>
</div>
<div class="container" *ngIf="popupService.selectLocksForEkey" [ngClass]="{'dark-mode': DarkModeService.darkMode}">
    <div class="header">
        Seleccione las cerraduras
    </div>
    <div id="content" style="justify-content: flex-start; ">
        <table class="lock-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Seleccionado</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngIf="popupService.locksOfGroup.length > 0; else noLocks">
                    <tr *ngFor="let lock of popupService.locksOfGroup">
                        <td>{{ lock.lockAlias }}</td>
                        <td style="text-align: center">
                            <input type="checkbox" [checked]="isLockSelected(lock.lockId)" (change)="toggleLockSelection(lock.lockId, lock.lockAlias)">
                        </td>
                    </tr>
                </ng-container>
                <ng-template #noLocks>
                    <tr>
                        <td colspan="2">No existen cerraduras disponibles para agregar a este grupo.</td>
                    </tr>
                </ng-template>
            </tbody>
        </table>
    </div>
    <p class="error">{{error}}</p>
    <div id="actions">
        <button (click)="popupService.selectLocksForEkey = false">Volver</button>
        <button (click)="this.popupService.selectLocksForEkey = false; confirmLockSelection()">Confirmar</button>
    </div>
</div>
